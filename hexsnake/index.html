<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HexSnake: Dimension Fold</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<canvas id="gameCanvas"></canvas>
<canvas id="minimap3d" width="160" height="120"></canvas>

<!-- HUD -->
<div id="hud">
  <div class="hSeg" style="flex-direction:column;align-items:flex-start;gap:1px">
    <span class="hLab">分数</span>
    <span class="hVal" id="hScore">0</span>
  </div>
  <div class="hSeg" style="flex-direction:column;align-items:flex-start;gap:1px">
    <span class="hLab">等级</span>
    <span class="hVal" id="hLevel">1</span>
  </div>
  <div class="hSeg" style="gap:10px">
    <div style="display:flex;flex-direction:column;gap:2px">
      <span class="hLab">经验</span>
      <div class="hBar" style="width:90px"><div class="hBarFill" id="xpFill" style="width:0%"></div></div>
    </div>
    <span style="font-family:'Share Tech Mono',monospace;font-size:12px;color:#4A4A48" id="hXP">0/5</span>
  </div>
  <div class="hSeg" style="gap:10px">
    <div style="display:flex;flex-direction:column;gap:2px">
      <span class="hLab">激光CD</span>
      <div class="hBar" style="width:70px"><div class="hBarFill" id="lasFill" style="width:100%"></div></div>
    </div>
  </div>
  <div class="hSeg" style="flex-direction:column;align-items:flex-start;gap:1px">
    <span class="hLab">长度</span>
    <span class="hVal" id="hLen">1</span>
  </div>
  <div class="hSeg" style="flex-direction:column;align-items:flex-start;gap:1px">
    <span class="hLab">速度</span>
    <span class="hVal" id="hSpd">×1.00</span>
  </div>
  <div class="hSeg" style="flex-direction:column;align-items:flex-start;gap:1px" id="hComboSeg">
    <span class="hLab">连击</span>
    <span class="hVal" id="hCombo" style="color:#E8640A">×1.0</span>
  </div>
  <div class="hSeg hRight" style="flex-direction:column;align-items:flex-end;gap:1px">
    <span class="hLab">任务时间</span>
    <span class="hVal" id="hTime">0s</span>
  </div>
  <button id="muteBtn" onclick="toggleMute()" style="
    margin-left:12px;background:none;border:1px solid #2E2E2A;color:#7A7670;
    font-family:'Share Tech Mono',monospace;font-size:12px;letter-spacing:1px;
    padding:4px 10px;cursor:pointer;pointer-events:all;
    transition:color .15s,border-color .15s;
  " title="切换静音 [M]">♪ ON</button>
</div>

<div id="effectBar"></div>
<div id="flashMsg"></div>

<!-- ══ START SCREEN — CASSETTE FUTURISM ══ -->
<div id="startScreen" class="overlay">
  <canvas id="startBg"></canvas>

  <!-- VHS Side Bars -->
  <div class="s-vhsbar left">
    <span class="svr"></span><span class="svy"></span><span class="svc"></span>
    <span class="svg_"></span><span class="svw"></span><span class="svk"></span><span class="svr"></span>
  </div>
  <div class="s-vhsbar right">
    <span class="svk"></span><span class="svw"></span><span class="svg_"></span>
    <span class="svc"></span><span class="svy"></span><span class="svr"></span><span class="svk"></span>
  </div>

  <!-- Top Status Bar -->
  <div class="s-topbar" id="topBar">
    <div class="s-tb-logo">
      <span class="s-tb-inf">∞</span>
      <div class="s-tb-name">
        <div class="s-tb-n1">RHINE LAB</div>
        <div class="s-tb-n2">COMBAT DIV · UNIT Ω</div>
      </div>
    </div>
    <div class="s-tb-rec"><span class="s-tb-recdot"></span>REC</div>
    <div class="s-tb-mid">
      <span>MISSION · <span class="accent">HX-2047</span></span>
      <span>PROTOCOL · <span class="accent">HEXSNAKE v2.1</span></span>
      <span id="s-clock">TIME · --:--:--</span>
    </div>
    <div class="s-tb-hi" id="sHiScore">BEST: —</div>
  </div>

  <!-- ── MAIN SPLIT LAYOUT ── -->
  <div class="s-main">

    <!-- ════ LEFT: White Mission Briefing Cabin ════ -->
    <div class="s-panel-white" id="panelWhite">

      <!-- Rhine Lab Logo (green on white) -->
      <div class="s-wlogo" data-reveal="1">
        <span class="s-wlogo-inf">∞</span>
        <div class="s-wlogo-txt">
          <span class="s-wlogo-t1">RHINE LAB</span>
          <span class="s-wlogo-t2">COMBAT DIVISION · HEXSNAKE PROTOCOL</span>
        </div>
      </div>

      <!-- Giant Title with Glitch -->
      <div class="s-wtitle" data-reveal="2">
        <span class="s-wtitle-hex">HEX</span>
        <span class="s-wtitle-snake">SNAKE</span>
      </div>

      <!-- ★ Prominent Tagline -->
      <div class="s-hero-tagline" data-reveal="3">六边形蛇类战略游戏</div>
      <div class="s-hero-sub" data-reveal="3">猎杀敌蛇 · 进化升级 · 称霸战场</div>

      <!-- VHS 4-Color Bar -->
      <div class="s-vhs-bar" data-reveal="4"></div>

      <!-- Cassette Tape Component (compact) -->
      <div class="s-cassette-wrap" data-reveal="5">
        <div class="s-cassette">
          <div class="s-cass-label">
            <span class="s-cass-l1">RHINE LAB</span>
            <span class="s-cass-l2">HX-2047</span>
          </div>
          <div class="s-cass-stripe"></div>
          <div class="s-cass-window">
            <div class="s-reel"></div>
            <div class="s-reel r2"></div>
          </div>
          <div class="s-cass-screw tl"></div>
          <div class="s-cass-screw tr"></div>
          <div class="s-cass-screw bl"></div>
          <div class="s-cass-screw br"></div>
        </div>
        <div class="s-cassette-side">
          <div class="s-cas-meta">SIDE A · 45:00</div>
          <div class="s-cas-meta">HEXSNAKE v2.1</div>
        </div>
      </div>

      <!-- Feature Badges -->
      <div class="s-badges" data-reveal="6">
        <span class="s-badge r">● 实时对战</span>
        <span class="s-badge g">◈ 进化树</span>
        <span class="s-badge c">◆ A* AI</span>
        <span class="s-badge y">⚡ 连击</span>
        <span class="s-badge w">♪ 音效</span>
      </div>

      <!-- Mode Toggle — Cassette A/B Switch -->
      <div class="s-mode-wrap" data-reveal="7">
        <div class="s-mode-label">SELECT MODE</div>
        <div class="s-mode-switch" id="modeSwitch" onclick="toggleGameMode()">
          <div class="s-mode-slider"><div class="s-mode-slider-inner"></div></div>
          <div class="s-mode-side active" id="modeSideA">
            <span class="s-mode-side-code">SIDE · A</span>
            <span class="s-mode-side-name">CLASSIC</span>
          </div>
          <div class="s-mode-side" id="modeSideB">
            <span class="s-mode-side-code">SIDE · B</span>
            <span class="s-mode-side-name">3D CUBE</span>
          </div>
          <div class="s-mode-screw tl"></div>
          <div class="s-mode-screw tr"></div>
          <div class="s-mode-screw bl"></div>
          <div class="s-mode-screw br"></div>
        </div>
      </div>

      <!-- Start Button -->
      <div class="s-start-area" data-reveal="7">
        <button class="s-startBtn" id="launchBtn" onclick="launchGame()">▶ 开始任务</button>
        <button class="s-startBtn-mute" onclick="toggleMute()">♪ 音效</button>
      </div>

      <!-- Light Crack Effect -->
      <div class="s-light-crack"></div>
      <div class="s-crack-particles">
        <div class="s-crack-particle"></div>
        <div class="s-crack-particle"></div>
        <div class="s-crack-particle"></div>
        <div class="s-crack-particle"></div>
        <div class="s-crack-particle"></div>
        <div class="s-crack-particle"></div>
      </div>

    </div>

    <!-- ════ RIGHT: Dark Control Panels ════ -->
    <div class="s-panel-dark" id="panelDark">

      <!-- TOP: Live Game Preview -->
      <div class="s-crt-display">
        <canvas id="previewCanvas" style="position:absolute;inset:0;width:100%;height:100%;z-index:5;"></canvas>
        <div class="s-crt-label">LIVE · COMBAT PREVIEW — AUTO PILOT</div>
        <div class="s-crt-corner tl"></div>
        <div class="s-crt-corner tr"></div>
        <div class="s-crt-corner bl"></div>
        <div class="s-crt-corner br"></div>
        <!-- Live data strip -->
        <div class="s-crt-data">
          <div class="s-crt-data-item">SCORE: <span id="demo-score">0</span></div>
          <div class="s-crt-data-item">LENGTH: <span id="demo-len">1</span></div>
          <div class="s-crt-data-item">KILLS: <span id="demo-kills">0</span></div>
          <div class="s-crt-data-item">STATUS: <span id="demo-status" style="color:var(--phosphor)">HUNTING</span></div>
        </div>
      </div>

      <!-- BOTTOM: Controls + Mission Cards -->
      <div class="s-control-panel">

        <!-- Controls -->
        <div class="s-controls-area">
          <div class="s-seclabel">OPERATION MANUAL</div>
          <table class="s-keytable">
            <tr>
              <td><span class="s-kb">↑↓←→ / WASD</span></td>
              <td class="s-kdesc">移动方向</td>
            </tr>
            <tr>
              <td><span class="s-kb">J</span></td>
              <td class="s-kdesc">发射激光攻击</td>
            </tr>
            <tr>
              <td><span class="s-kb" style="border-bottom-color:var(--phosphor)">● XP球</span></td>
              <td class="s-kdesc">收集触发升级</td>
            </tr>
            <tr>
              <td><span class="s-kb" style="border-bottom-color:var(--amber)">▲ 加速</span></td>
              <td class="s-kdesc">速度倍率叠加</td>
            </tr>
            <tr>
              <td><span class="s-kb" style="border-bottom-color:var(--vhs-c)">▼ 减速</span></td>
              <td class="s-kdesc">速度倍率降低</td>
            </tr>
            <tr>
              <td><span class="s-kb">M</span></td>
              <td class="s-kdesc">BGM 开关</td>
            </tr>
          </table>
        </div>

        <div class="s-cp-div"></div>

        <!-- Mission System Cards -->
        <div class="s-cards-area">
          <div class="s-seclabel">MISSION SYSTEMS</div>
          <div class="s-card">
            <div class="s-card-lstrip"></div>
            <div class="s-card-head">
              <span class="s-card-icon">⚡</span>
              <span class="s-card-title">连击倍率</span>
              <span class="s-card-id">SYS-01</span>
            </div>
            <div class="s-card-desc">连续吃食物 ×1→×4 倍率累积</div>
          </div>
          <div class="s-card g">
            <div class="s-card-lstrip"></div>
            <div class="s-card-head">
              <span class="s-card-icon">◈</span>
              <span class="s-card-title">进化树系统</span>
              <span class="s-card-id">SYS-02</span>
            </div>
            <div class="s-card-desc">升级解锁10种进化路径</div>
          </div>
          <div class="s-card r">
            <div class="s-card-lstrip"></div>
            <div class="s-card-head">
              <span class="s-card-icon">◉</span>
              <span class="s-card-title">敌蛇 AI</span>
              <span class="s-card-id">SYS-03</span>
            </div>
            <div class="s-card-desc">A* 寻路 + 子弹攻击系统</div>
          </div>
          <div class="s-card c">
            <div class="s-card-lstrip"></div>
            <div class="s-card-head">
              <span class="s-card-icon">◫</span>
              <span class="s-card-title">动态地图</span>
              <span class="s-card-id">SYS-04</span>
            </div>
            <div class="s-card-desc">升级扩张 · 墙体随机阻断</div>
          </div>
        </div>

      </div>
    </div>

  </div>

  <!-- Bottom Info Bar -->
  <div class="s-bottombar" id="bottomBar">
    <span class="s-ver">BUILD RHINE·2025 · HX-2047 · INTERNAL USE ONLY · CLASSIFIED</span>
  </div>

</div>

<!-- Evolution Tree -->
<div id="evoScreen" class="overlay">
  <div class="evoHeader">
    <div>
      <div style="font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(232,100,10,0.5);letter-spacing:3px;margin-bottom:5px">RHINE LAB · EVOLUTION PROTOCOL v2.1</div>
      <div class="evoTitle">干员进化</div>
    </div>
    <div class="evoHint">点击亮节点选择 · 确认后升级生效<br><span style="color:rgba(232,100,10,0.4)">[F2] 调试升级</span></div>
  </div>
  <canvas id="evoCanvas" width="820" height="480"></canvas>
  <div class="evoWarn" id="evoWarn"></div>
  <button class="bigBtn" style="margin-top:12px" onclick="confirmUpgrade()">确认升级</button>
</div>

<!-- Countdown Overlay -->
<div id="countdownOverlay" style="
  display:none;position:fixed;inset:0;z-index:200;
  background:rgba(4,3,1,0.88);
  display:none;align-items:center;justify-content:center;flex-direction:column;gap:18px;
  font-family:'Barlow Condensed',sans-serif;
">
  <div style="font-family:'Share Tech Mono',monospace;font-size:14px;letter-spacing:4px;color:rgba(0,255,136,0.55)">UPGRADE INSTALLED · RESUMING IN</div>
  <div id="countdownNum" style="
    font-size:140px;font-weight:900;line-height:1;letter-spacing:-4px;
    color:var(--amber);text-shadow:0 0 60px rgba(255,184,48,0.5),0 0 120px rgba(255,184,48,0.15);
  ">3</div>
  <div id="countdownUpgName" style="font-size:22px;font-weight:700;letter-spacing:4px;color:rgba(232,100,10,0.8)"></div>
</div>

<!-- Game Over — CRT Signal Recovery -->
<div id="goScreen" class="overlay">
  <canvas id="goBg"></canvas>
  <div class="sCorner tl" style="z-index:3"></div>
  <div class="sCorner tr" style="z-index:3;border-color:#C8281E"></div>
  <div class="sCorner bl" style="z-index:3;border-color:#5C9B2E"></div>
  <div class="sCorner br" style="z-index:3"></div>

  <!-- CRT Boot Line -->
  <div class="go-bootline" id="goBootline"></div>

  <div class="go-crt" id="goCrt">
    <!-- Language Toggle -->
    <button class="go-lang-toggle" id="goLangBtn" onclick="toggleGoLang()">EN / 中</button>

    <!-- Header -->
    <div class="go-header go-reveal">
      <div>
        <div class="go-status" data-i18n="go_status">SIGNAL RECOVERED · MISSION LOG</div>
        <div class="go-title">GAME <span>OVER</span></div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
        <div class="go-record-tag new" id="goNewRecord" style="display:none" data-i18n="go_newrec">★ NEW RECORD</div>
        <div class="go-record-tag normal" id="goNoRecord" style="display:none" data-i18n="go_norec">MISSION FAILED</div>
        <div id="goTimeTag" style="font-family:'Share Tech Mono',monospace;font-size:12px;color:#5A5650;letter-spacing:2px"></div>
      </div>
    </div>

    <!-- Body -->
    <div class="go-body">
      <!-- Left: Big Score -->
      <div class="go-left">
        <div class="go-score-label go-reveal" data-i18n="go_scorelbl">FINAL SCORE</div>
        <div class="go-score-num go-reveal" id="goScore">0</div>
        <div class="go-hiscore-line go-reveal"><span data-i18n="go_best">BEST:</span> <span id="goHiScore">0</span></div>

        <div class="go-datalines">
          <div class="go-dline go-reveal">
            <span data-i18n="go_level">LEVEL REACHED</span>
            <span class="go-dline-val amber" id="goLevel">1</span>
          </div>
          <div class="go-dline go-reveal">
            <span data-i18n="go_time">SURVIVAL TIME</span>
            <span class="go-dline-val" id="goTime">0s</span>
          </div>
          <div class="go-dline go-reveal">
            <span data-i18n="go_length">FINAL LENGTH</span>
            <span class="go-dline-val" id="goLen">1</span>
          </div>
          <div class="go-dline go-reveal">
            <span data-i18n="go_combo">MAX COMBO</span>
            <span class="go-dline-val amber" id="goCombo">0</span>
          </div>
        </div>
      </div>

      <!-- Right: Terminal Log -->
      <div class="go-right">
        <div class="go-terminal-header go-reveal" data-i18n="go_logheader">COMBAT LOG · DETAILED REPORT</div>

        <div class="go-tline go-reveal">
          <div class="go-tline-row">
            <span class="t-key" data-i18n="go_kills">ENEMY.KILLS</span>
            <span class="t-dot"></span>
            <span class="t-val" id="goKills">0</span>
          </div>
        </div>
        <div class="go-tline go-reveal">
          <div class="go-tline-row">
            <span class="t-key" data-i18n="go_laser">LASER.HITS</span>
            <span class="t-dot"></span>
            <span class="t-val" id="goLasHits">0</span>
          </div>
        </div>
        <div class="go-tline go-reveal">
          <div class="go-tline-row">
            <span class="t-key" data-i18n="go_bullet">BULLET.DMG</span>
            <span class="t-dot"></span>
            <span class="t-val" id="goBulletHits">—</span>
          </div>
        </div>
        <div class="go-tline go-reveal">
          <div class="go-tline-row">
            <span class="t-key" data-i18n="go_statusk">STATUS</span>
            <span class="t-dot"></span>
            <span class="t-val" style="color:#C8281E" data-i18n="go_statusv">TERMINATED</span>
          </div>
        </div>
        <div class="go-tline go-reveal">
          <div class="go-tline-row">
            <span class="t-key" data-i18n="go_logend">LOG.END</span>
            <span class="t-dot"></span>
            <span class="t-val">OK</span>
            <span class="go-cursor"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="go-footer go-reveal">
      <div class="go-cmd"><kbd>ENTER</kbd> <span data-i18n="go_quick">快速重开</span></div>
      <button class="bigBtn ghost" id="homeBtn" onclick="launchHome(this)" data-i18n="go_home">← 返回主界面</button>
      <button class="bigBtn" id="redeployBtn" onclick="launchRedeploy(this)" data-i18n="go_redeploy">▶ 重新部署</button>
    </div>
  </div>
</div>

<!-- Game Launch Transition Overlay -->
<div id="launchTransition"></div>

<!-- JS modules in dependency order (global scope shared) -->
<script src="js/constants.js"></script>
<script src="js/state.js"></script>
<script src="js/audio.js"></script>
<script src="js/utils.js"></script>
<script src="js/ui.js"></script>
<script src="js/game-2d.js"></script>
<script src="js/game-3d.js"></script>
<script src="js/background.js"></script>
<script src="js/main.js"></script>
</body>
</html>
